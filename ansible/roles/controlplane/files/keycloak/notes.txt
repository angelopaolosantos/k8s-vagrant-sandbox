https://stackoverflow.com/questions/73883728/keycloak-admin-console-loading-indefinitely

https://medium.com/@charled.breteche/kind-keycloak-securing-kubernetes-api-server-with-oidc-371c5faef902

https://github.com/int128/kubelogin/issues/29

https://andrewtarry.com/posts/custom-dns-in-kubernetes/

KEYCLOAK_PROXY to edge

update keycloak configmap


Patch the configmap to add ENV KC_PROXY
# Get the configmap deployed for keycloak
$ kubectl get configmap -n <namespace>                        
NAME                DATA   AGE
keycloak-env-vars   15     xx

# Ensure you are doing it in the namespace where keycloak is deployed
kubectl patch configmap keycloak-env-vars -n <namespace> --type merge --patch '{"data":{"KC_PROXY":"edge"}}'

# Get the pod using configmap and restart the same
$ kubectl get pods -n <namespace>
NAME                    READY   STATUS    RESTARTS   AGE
keycloak-0              1/1     Running   0          xx
keycloak-postgresql-0   1/1     Running   0          xx

$ kubectl delete pod keycloak-0 -n <namespace>



Install krew
kubectl krew install oidc-login

kubectl oidc-login setup \
--oidc-issuer-url=https://keycloak.localdev.me/realms/master \
--oidc-client-id=kube \
--oidc-client-secret=e0217XKdOK1qZnwoz29XgwpVL6iLvSya \
--insecure-skip-tls-verify


rm -rf ~/.kube/cache
rm -rf ~/.kube/http-cache

sudo kubectl kustomize overlays/dev


# create certificate configuration file
cat <<EOF > .ssl/req.cnf
[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name
[req_distinguished_name]
[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names
[alt_names]
DNS.1 = keycloak.kind.cluster
EOF
# generate private key
openssl genrsa -out .ssl/key.pem 2048
# create certificate signing request
openssl req -new -key .ssl/key.pem -out .ssl/csr.pem \
  -subj "/CN=kube-ca" \
  -addext "subjectAltName = DNS:keycloak.kind.cluster" \
  -sha256 -config .ssl/req.cnf
# create certificate
openssl x509 -req -in .ssl/csr.pem \
  -CA .ssl/root-ca.pem -CAkey .ssl/root-ca-key.pem \
  -CAcreateserial -sha256 -out .ssl/cert.pem -days 3650 \
  -extensions v3_req -extfile .ssl/req.cnf
# create secret used by keycloak ingress
kubectl create secret tls -n keycloak keycloak.kind.cluster-tls \
  --cert=.ssl/cert.pem \
  --key=.ssl/key.pem